<Window
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:av="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="av" x:Class="AppCommander.W7_11.WPF.MainWindow"
        Title="AppCommander" 
        Height="900" Width="1400" 
        MinHeight="500" MinWidth="1020"
        Icon="appcommander_icon.ico"
        WindowStartupLocation="CenterScreen" 
        FontSize="14" 
        FontFamily="Segoe UI"
        Background="{DynamicResource WindowBackgroundBrush}">
        <!-- Background="#dde7f0"> -->

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Border Grid.Row="0" Background="White" BorderBrush="#E1E1E1" BorderThickness="0,0,0,1">
            <Menu x:Name="menuBar" Background="Transparent" Padding="8" Margin="1,0,-1,0">
                <MenuItem Header="_File" Foreground="#323130" Style="{StaticResource TopLevelMenuItem}">
                    <MenuItem Header="_New Sequence" Click="NewSequence_Click" InputGestureText="Ctrl+N" Style="{StaticResource MenuItemStyle}" />
                    <MenuItem Header="_Open Sequence..." Click="OpenSequence_Click" InputGestureText="Ctrl+O" Style="{StaticResource MenuItemStyle}" />
                    <Separator/>
                    <MenuItem Header="_Save Sequence" Click="SaveSequence_Click" InputGestureText="Ctrl+S" Style="{StaticResource MenuItemStyle}" />
                    <MenuItem Header="Save Sequence _As..." Click="SaveSequenceAs_Click" InputGestureText="Ctrl+Shift+S" Style="{StaticResource MenuItemStyle}" />
                    <Separator/>
                    <MenuItem Header="E_xit" Click="Exit_Click" InputGestureText="Alt+F4" Style="{StaticResource MenuItemStyle}" />
                </MenuItem>

                <MenuItem Header="_Commands" Foreground="#323130" Style="{StaticResource TopLevelMenuItem}">
                    <MenuItem Header="Add _Wait Command..." Click="AddWaitCommand_Click" Style="{StaticResource MenuItemStyle}" />
                    <MenuItem Header="Add _Loop Start" Click="AddLoopStart_Click" Style="{StaticResource MenuItemStyle}" />
                    <MenuItem Header="Add Loop _End" Click="AddLoopEnd_Click" Style="{StaticResource MenuItemStyle}" />
                    <Separator/>
                    <MenuItem Header="_Edit Selected Command..." Click="EditCommand_Click" Style="{StaticResource MenuItemStyle}" />
                    <MenuItem Header="_Delete Selected Command" Click="DeleteCommand_Click" Style="{StaticResource MenuItemStyle}" />
                </MenuItem>

                <MenuItem Header="_Tools" Foreground="#323130" Style="{StaticResource TopLevelMenuItem}">
                    <MenuItem Header="_Window Selector" Click="WindowSelector_Click" Style="{StaticResource MenuItemStyle}" />
                    <MenuItem Header="_Element Inspector" Click="ElementInspector_Click" Style="{StaticResource MenuItemStyle}" />
                    <MenuItem Header="_Settings" Click="Settings_Click" Style="{StaticResource MenuItemStyle}" />
                </MenuItem>

                <MenuItem Header="Th_emes" Foreground="#323130" Style="{StaticResource TopLevelMenuItem}">
                    <!-- Theme options ako checkable menu items -->
                    <MenuItem Header="System Default"  IsCheckable="True" IsChecked="True" 
                        Click="ThemeMenuItem_Click" Tag="System" Style="{StaticResource MenuItemStyle}" />
                    <Separator Margin="0,4"/>
                    <MenuItem Header="Light Theme"   IsCheckable="True" 
                        Click="ThemeMenuItem_Click" Tag="Light" Style="{StaticResource MenuItemStyle}"/>

                    <MenuItem Header="Dark Theme"    IsCheckable="True" 
                        Click="ThemeMenuItem_Click" Tag="Dark" Style="{StaticResource MenuItemStyle}"/>
                    <MenuItem Header="High Contrast"    IsCheckable="True" 
                        Click="ThemeMenuItem_Click" Tag="HighContrast" Style="{StaticResource MenuItemStyle}"/>
                </MenuItem>



                <!--<MenuItem Header="_Settings" Foreground="#323130" Style="{StaticResource TopLevelMenuItem}">
                    <MenuItem Header="_System Theme" Click="SystemTheme_Click" Style="{StaticResource MenuItemStyle}" />
                    <CheckBox x:Name="SystemThemeCheckBox" IsChecked="True" Checked="SystemTheme_Checked" Unchecked="SystemTheme_Unchecked" />
                    
                    <MenuItem Header="_Light Theme" Click="LightTheme_Click" Style="{StaticResource MenuItemStyle}" />
                    <CheckBox x:Name="LightThemeCheckBox" IsChecked="False" Checked="LightThemeCheckBox_Checked" Unchecked="LightThemeCheckBox_Unchecked" />
                    
                    <MenuItem Header="_Dark Theme" Click="DarkTheme_Click" Style="{StaticResource MenuItemStyle}" />
                    <CheckBox x:Name="DarkThemeCheckBox" IsChecked="False" Checked="Dark_Checked" Unchecked="Dark_Unchecked"  />

                    <MenuItem Header="_High Contrast Theme" Click="HighContrastTheme_Click" Style="{StaticResource MenuItemStyle}" />
                    <CheckBox x:Name="HighContrastThemeCheckBox" IsChecked="False" Checked="HighContrast_Checked" Unchecked="HighContrast_Unchecked"  />
                </MenuItem>-->

                <MenuItem Header="_Help" Foreground="#323130" Style="{StaticResource TopLevelMenuItem}">
                    <MenuItem Header="_User Guide" Click="UserGuide_Click" Style="{StaticResource MenuItemStyle}" />
                    <MenuItem Header="_About" Click="About_Click" Style="{StaticResource MenuItemStyle}" />
                </MenuItem>
            </Menu>
        </Border>

        <!-- Toolbar -->
        <Border Grid.Row="1" Background="White" BorderBrush="#E1E1E1" BorderThickness="0,0,0,1" Padding="16">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <!-- Target Selection -->
                <StackPanel Orientation="Horizontal" Margin="0,0,24,0">
                    <Button x:Name="btnSelectTargetByClick" Content="🎯 Click to Select" 
                            Style="{StaticResource PrimaryButton}" 
                            Click="SelectTargetByClick_Click" 
                            Margin="0,0,8,0" Height="36"/>
                    <Button x:Name="btnSelectTarget" Content="📋 Browse" 
                            Style="{StaticResource SecondaryButton}" 
                            Click="SelectTarget_Click" Height="36"/>
                </StackPanel>

                <Separator Margin="0,0,24,0" Style="{x:Null}" Background="#E1E1E1" Width="1"/>

                <!-- Recording Controls -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,0">
                    <Button x:Name="btnRecording" Content="🔴 Start Recording" 
                            Style="{StaticResource DangerButton}" 
                            Click="ToggleRecording_Click" Height="36" Margin="0,0,8,0"/>
                </StackPanel>

                <Separator Margin="0,0,24,0" Style="{x:Null}" Background="#E1E1E1" Width="1"/>

                <!-- Playback Controls -->
                <StackPanel Orientation="Horizontal">
                    <Button x:Name="btnPlayCommands" Content="         ▶    Play            " 
                            Style="{StaticResource PrimaryButton}" 
                            Click="PlaySequence_Click" Height="36" Margin="0,0,4,0"/>

                    <StackPanel Orientation="Vertical">

                        <TextBlock Text="Repeat" VerticalAlignment="Center" Margin="12,0,8,0" 
                               FontWeight="SemiBold" Foreground="#323130"/>
                        <TextBox x:Name="txtRepeatCount" Text="1" 
                                 Style="{StaticResource TextBoxStyle}"     
                                 Width="50" Height="36" TextAlignment="Center" Margin="10,0,8,18"/>
                    </StackPanel>
                        
                        <CheckBox x:Name="chkInfiniteLoop" Content="∞" VerticalAlignment="Center"  FontStretch="UltraExpanded" FontWeight="ExtraBold"
                                  Checked="InfiniteLoop_Checked" Unchecked="InfiniteLoop_Unchecked" Margin="0,0,16,-3"/>

                    <Button x:Name="btnPause" Content="⏸ Pause" 
                            Style="{StaticResource SecondaryButton}" 
                            Click="PausePlayback_Click" Height="36" Margin="0,0,4,0" IsEnabled="False"/>
                    <Button x:Name="btnStop" Content="⏹ Stop" 
                            Style="{StaticResource SecondaryButton}" 
                            Click="StopPlayback_Click" Height="36" IsEnabled="False"/>

                    <!-- Info TextBoxes -->
                    <StackPanel Orientation="Vertical" Margin="20,6,6,6">
                        <TextBlock x:Name="txtSetCount" Text="0 sets" 
                            Foreground="#605E5C"  FontSize="12" />
                        <TextBlock x:Name="txtSequenceCount" Text="0 sequences" 
                            Foreground="#605E5C"  FontSize="12"/>
                        <TextBlock x:Name="txtCommandsCount" Text="0 commands" 
                            Foreground="#605E5C"  FontSize="12"/>
                    </StackPanel>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="2" Margin="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="320"/>
            </Grid.ColumnDefinitions>

            <!-- Commands Panel -->
            <Border Style="{StaticResource CardStyle}">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <Grid Grid.Row="0" Margin="0,0,0,16">
                        <TextBlock Text="Recorded Commands" FontSize="18" FontWeight="SemiBold" 
                           Foreground="#323130" VerticalAlignment="Center"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <TextBlock x:Name="txtCommandCount" Text="0 commands" 
                               Foreground="#605E5C" VerticalAlignment="Center" FontSize="12"/>
                        </StackPanel>
                        <TextBox x:Name="txtSequenceName" Text="Commands_Sequence" 
                             Style="{StaticResource TextBoxStyle}" Margin="207,5,87,-4" ToolTip="Name this sequence of commands."/>
                    </Grid>

                    <DataGrid x:Name="dgUnified" AutoGenerateColumns="False" Style="{StaticResource DataGridStyle}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="#" Binding="{Binding StepNumber}" Width="40"/>
                            <DataGridTextColumn Header="Type" Binding="{Binding TypeDisplay}" Width="100"/>
                            <DataGridTextColumn Header="Name/Element" Binding="{Binding Name}" Width="200"/>
                            <DataGridTextColumn Header="Action" Binding="{Binding Action}" Width="120"/>
                            <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="120"/>
                            <DataGridTextColumn Header="Repeat" Binding="{Binding RepeatCount}" Width="80"/>
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="80"/>
                            <DataGridTextColumn Header="Time" Binding="{Binding Timestamp, StringFormat=HH:mm:ss}" Width="80"/>
                            <DataGridCheckBoxColumn Header="Command" Binding="{Binding Status}" Width="70" />
                            <DataGridCheckBoxColumn Header="Sequence" Binding="{Binding Status}" Width="65"/>
                            <DataGridCheckBoxColumn Header="Set" Binding="{Binding Status}" Width="40"/>
                        </DataGrid.Columns>

                        <!-- Custom row styling based on ItemType -->
                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Type}" Value="Command">
                                        <Setter Property="Background" Value="#F8F9FA"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Type}" Value="Sequence">
                                        <Setter Property="Background" Value="#E3F2FD"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>
                    </DataGrid>

                    <StackPanel Orientation="Horizontal" Grid.Row="2">

                        <Button Content=" ✏ Edit   " Click="EditItem_Click" Margin="0,2,8,0"  Style="{StaticResource SecondaryButton}"/>
                        <!--<Button Content="🗑 Delete" Click="DeleteItem_Click" Margin="0,0,8,0"  Style="{StaticResource DangerButton}"/>-->

                        <!-- Reordering -->
                        <Button Content="⬆ Move Up   " Click="MoveUp_Click" Margin="2,2,8,0"  Style="{StaticResource SecondaryButton}"/>
                        <Button Content="⬇ Move Down " Click="MoveDown_Click" Margin="0,2,8,2"  Style="{StaticResource SecondaryButton}"/>

                        <Button Content="➕ Add  Sequence" Click="AddSequence_Click"  Margin="0,0,8,0" Style="{StaticResource PrimaryButton}"/>
                        <Button Content="📁Add Cmd" Click="AddFromCommands_Click"  Margin="2,2,8,2" Style="{StaticResource SecondaryButton}"/>

                        <Button Content="💾 Save as Set" Click="SaveAsSet_Click" Margin="0,2,8,2"  Style="{StaticResource SecondaryButton}"/>

                        
                    </StackPanel>

                </Grid>
            </Border>

            <!-- Side Panel -->
            <ScrollViewer Grid.Column="4" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Style="{StaticResource ScrollViewerStyle}">
                <StackPanel>
                    <!-- Target Information Card -->
                    <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                        <StackPanel Margin="16">
                            <TextBlock Text="Target Information" FontSize="16" FontWeight="SemiBold" 
                               Foreground="#323130" Margin="0,0,0,12"/>

                            <!-- Selection Status -->
                            <Border x:Name="selectionModeIndicator" 
                            Background="#FFF4CE" BorderBrush="#F7C52D" BorderThickness="1" 
                            CornerRadius="4" Padding="8" Margin="0,0,0,12" Visibility="Collapsed">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="🎯" Margin="0,0,6,0"/>
                                    <TextBlock x:Name="txtSelectionMode" Text="Click Selection Active" 
                                       FontWeight="SemiBold" Foreground="#8A6914"/>
                                </StackPanel>
                            </Border>

                            <!-- Target Details -->
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Window:" 
                                   FontWeight="SemiBold" Margin="0,0,8,4" Foreground="#323130"/>
                                <TextBlock x:Name="lblTargetWindow" Grid.Row="0" Grid.Column="1" 
                                   Text="No target selected" Foreground="#605E5C" 
                                   TextWrapping="Wrap" Margin="0,0,0,4"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Process:" 
                                   FontWeight="SemiBold" Margin="0,0,8,4" Foreground="#323130"/>
                                <TextBlock x:Name="txtTargetProcess" Grid.Row="1" Grid.Column="1" 
                                   Text="-" Foreground="#605E5C" Margin="0,0,0,4"/>
                            </Grid>

                            <!-- Quick Actions -->
                            <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                                <Button x:Name="btnQuickReselect" Content="🔄 Reselect" 
                                Click="SelectTargetByClick_Click" 
                                Style="{StaticResource SecondaryButton}" 
                                Height="32" Padding="8,4" Margin="0,0,8,0" FontSize="12"/>
                                <Button x:Name="btnQuickBrowse" Content="📋 Browse" 
                                Click="SelectTarget_Click" 
                                Style="{StaticResource SecondaryButton}" 
                                Height="32" Padding="8,4" FontSize="12"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Status Card -->
                    <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                        <StackPanel Margin="16">
                            <TextBlock Text="System Status" FontSize="16" FontWeight="SemiBold" 
                               Foreground="#323130" Margin="0,0,0,12"/>

                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <Ellipse Width="8" Height="8" Fill="#D13438" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock x:Name="lblAutoDetectionStatus" Text="Auto-Detection Inactive" 
                                       Foreground="#605E5C" FontSize="12"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <Ellipse Width="8" Height="8" Fill="#D13438" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock x:Name="lblUIRecordingStatus" Text="UI Scanning Inactive" 
                                       Foreground="#605E5C" FontSize="12"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Auto Mode Toggle -->
                            <Button x:Name="btnToggleAutoMode" Content="🎯 Auto Mode OFF" 
                            Click="ToggleAutomaticMode_Click" 
                            Style="{StaticResource SecondaryButton}" 
                            HorizontalAlignment="Stretch" Height="32" Margin="0,8,0,0"/>

                            <ProgressBar x:Name="progressEnhancedRecording" Height="4" 
                                 Background="#F3F2F1" Foreground="#0078D4"
                                 IsIndeterminate="False" Visibility="Collapsed" Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Quick Actions Card -->
                    <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                        <StackPanel Margin="16">
                            <TextBlock Text="Quick Actions" FontSize="16" FontWeight="SemiBold" 
                               Foreground="#323130" Margin="0,0,0,12"/>

                            <StackPanel>
                                <Button Content="🔍 Element Inspector" Click="ElementInspector_Click" 
                                Style="{StaticResource SecondaryButton}" 
                                HorizontalAlignment="Stretch" Height="36" Margin="0,0,0,8"/>
                                <Button Content="⚙ Settings" Click="Settings_Click" 
                                Style="{StaticResource SecondaryButton}" 
                                HorizontalAlignment="Stretch" Height="36" Margin="0,0,0,8"/>
                                <Button Content="📊 Debug Info" Click="ExportSequenceForDebug_Click" 
                                Style="{StaticResource SecondaryButton}" 
                                HorizontalAlignment="Stretch" Height="36"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Element Statistics Card -->
                    <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                        <StackPanel Margin="16">
                            <TextBlock Text="Element Statistics" FontSize="16" FontWeight="SemiBold" 
                               Foreground="#323130" Margin="0,0,0,12"/>

                            <ListBox x:Name="lstElementStats" Height="120" Background="Transparent" 
                             BorderThickness="0" FontSize="12">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Margin="0,2">
                                            <TextBlock Text="{Binding ElementName}" FontWeight="SemiBold" Foreground="#323130"/>
                                            <TextBlock Text="{Binding UsageCount, StringFormat=Used: \{0\} times}" 
                                               FontSize="11" Foreground="#605E5C"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>

                            <Button Content="↻ Refresh Stats" Click="AutoRefreshAllUIElements_Click" 
                            Style="{StaticResource SecondaryButton}" 
                            HorizontalAlignment="Stretch" Height="32" Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="White" BorderBrush="#E1E1E1" BorderThickness="0,1,0,0" 
                Padding="16,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock x:Name="txtStatusBar" Grid.Column="0" 
                           Text="Ready" FontWeight="SemiBold" Foreground="#0078D4"/>

                <TextBlock x:Name="txtTarget" Grid.Column="1" 
                           Text="No target selected" Foreground="#605E5C" 
                           Margin="16,0"/>

                <TextBlock x:Name="lblStatusBarRecording" Grid.Column="2" 
                           Text="Not Recording" Foreground="#605E5C"/>
            </Grid>
        </Border>
    </Grid>
</Window>